<server xmlns="urn:jboss:domain:2.2">
	<extensions>
		<extension module="org.jboss.as.clustering.infinispan" />
		<extension module="org.jboss.as.connector" />
		<extension module="org.jboss.as.deployment-scanner" />
		<extension module="org.jboss.as.ee" />
		<extension module="org.jboss.as.ejb3" />
		<extension module="org.jboss.as.jaxrs" />
		<extension module="org.jboss.as.jdr" />
		<extension module="org.jboss.as.jmx" />
		<extension module="org.jboss.as.jpa" />
		<extension module="org.jboss.as.jsf" />
		<extension module="org.jboss.as.logging" />
		<extension module="org.jboss.as.mail" />
		<extension module="org.jboss.as.naming" />
		<extension module="org.jboss.as.pojo" />
		<extension module="org.jboss.as.remoting" />
		<extension module="org.jboss.as.sar" />
		<extension module="org.jboss.as.security" />
		<extension module="org.jboss.as.transactions" />
		<extension module="org.jboss.as.webservices" />
		<extension module="org.jboss.as.weld" />
		<extension module="org.wildfly.extension.batch" />
		<extension module="org.wildfly.extension.io" />
		<extension module="org.wildfly.extension.undertow" />
	</extensions>
	<management>
		<security-realms>
			<security-realm name="ManagementRealm">
				<authentication>
					<local default-user="$local" skip-group-loading="true" />
					<properties path="mgmt-users.properties" relative-to="jboss.server.config.dir" />
				</authentication>
				<authorization map-groups-to-roles="false">
					<properties path="mgmt-groups.properties" relative-to="jboss.server.config.dir" />
				</authorization>
			</security-realm>
			<security-realm name="ApplicationRealm">
				<authentication>
					<local default-user="$local" allowed-users="*"
						skip-group-loading="true" />
					<properties path="application-users.properties"
						relative-to="jboss.server.config.dir" />
				</authentication>
				<authorization>
					<properties path="application-roles.properties"
						relative-to="jboss.server.config.dir" />
				</authorization>
			</security-realm>
		</security-realms>
		<audit-log>
			<formatters>
				<json-formatter name="json-formatter" />
			</formatters>
			<handlers>
				<file-handler name="file" formatter="json-formatter"
					path="audit-log.log" relative-to="jboss.server.data.dir" />
			</handlers>
			<logger log-boot="true" log-read-only="false" enabled="false">
				<handlers>
					<handler name="file" />
				</handlers>
			</logger>
		</audit-log>
		<management-interfaces>
			<http-interface security-realm="ManagementRealm"
				http-upgrade-enabled="true">
				<socket-binding http="management-http" />
			</http-interface>
		</management-interfaces>
		<access-control provider="simple">
			<role-mapping>
				<role name="SuperUser">
					<include>
						<user name="$local" />
					</include>
				</role>
			</role-mapping>
		</access-control>
	</management>
	<profile>
		<subsystem xmlns="urn:jboss:domain:logging:2.0">
			<console-handler name="CONSOLE">
				<level name="INFO" />
				<formatter>
					<named-formatter name="COLOR-PATTERN" />
				</formatter>
			</console-handler>
			<periodic-rotating-file-handler name="FILE"
				autoflush="true">
				<formatter>
					<named-formatter name="PATTERN" />
				</formatter>
				<file relative-to="jboss.server.log.dir" path="server.log" />
				<suffix value=".yyyy-MM-dd" />
				<append value="true" />
			</periodic-rotating-file-handler>
			<logger category="com.arjuna">
				<level name="WARN" />
			</logger>
			<logger category="org.apache.tomcat.util.modeler">
				<level name="WARN" />
			</logger>
			<logger category="org.jboss.as.config">
				<level name="DEBUG" />
			</logger>
			<logger category="sun.rmi">
				<level name="WARN" />
			</logger>
			<logger category="jacorb">
				<level name="WARN" />
			</logger>
			<logger category="jacorb.config">
				<level name="ERROR" />
			</logger>
			<root-logger>
				<level name="INFO" />
				<handlers>
					<handler name="CONSOLE" />
					<handler name="FILE" />
				</handlers>
			</root-logger>
			<formatter name="PATTERN">
				<pattern-formatter
					pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n" />
			</formatter>
			<formatter name="COLOR-PATTERN">
				<pattern-formatter pattern="%K{level}%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n" />
			</formatter>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:batch:1.0">
			<job-repository>
				<in-memory />
			</job-repository>
			<thread-pool>
				<max-threads count="10" />
				<keepalive-time time="30" unit="seconds" />
			</thread-pool>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:datasources:2.0">
			<datasources>
				<datasource jndi-name="java:jboss/datasources/ExampleDS"
					pool-name="ExampleDS" use-java-context="true">
					<connection-url>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
					</connection-url>
					<driver>h2</driver>
					<security>
						<user-name>sa</user-name>
						<password>sa</password>
					</security>
				</datasource>
				<datasource jndi-name="java:jboss/datasources/irct-cl-DS" pool-name="ComunicationLayerDS" use-java-context="true">
                    <connection-url>jdbc:mysql://${env.IRCT_DB_HOST}:${env.IRCT_DB_PORT:3306}/irct?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;autoReconnectForPools=true&amp;useSSL=false</connection-url>
                    <driver>mysql</driver>
                    <security>
                        <user-name>${env.IRCT_DB_CONNECTION_USER}</user-name>
                        <password>${env.IRCT_DB_PASSWORD}</password>
                    </security>
					<pool>
						<min-pool-size>5</min-pool-size>
						<max-pool-size>50</max-pool-size>
						<prefill>true</prefill>
					</pool>
					<validation>
						<valid-connection-checker
							class-name="org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLValidConnectionChecker" />
						<check-valid-connection-sql>SELECT 1</check-valid-connection-sql>
						<validate-on-match>true</validate-on-match>
						<background-validation>false</background-validation>
						<exception-sorter
							class-name="org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLExceptionSorter" />
					</validation>
				</datasource>
				<drivers>
					<driver name="h2" module="com.h2database.h2">
						<xa-datasource-class>org.h2.jdbcx.JdbcDataSource
						</xa-datasource-class>
					</driver>
					<driver name="mysql" module="com.sql.mysql">
						<driver-class>com.mysql.jdbc.Driver</driver-class>
					</driver>
				</drivers>
			</datasources>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:deployment-scanner:2.0">
			<deployment-scanner scan-enabled="true" path="deployments"
				auto-deploy-zipped="true" auto-deploy-exploded="false"
				relative-to="jboss.server.base.dir" scan-interval="0" />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:ee:2.0">
			<global-modules>
				<module name="com.oracle" slot="main" />
			</global-modules>
			<spec-descriptor-property-replacement>false
			</spec-descriptor-property-replacement>
			<concurrent>
				<context-services>
					<context-service name="default"
						jndi-name="java:jboss/ee/concurrency/context/default"
						use-transaction-setup-provider="true" />
				</context-services>
				<managed-thread-factories>
					<managed-thread-factory name="default"
						jndi-name="java:jboss/ee/concurrency/factory/default"
						context-service="default" />
				</managed-thread-factories>
				<managed-executor-services>
					<managed-executor-service name="default"
						jndi-name="java:jboss/ee/concurrency/executor/default"
						context-service="default" hung-task-threshold="60000"
						core-threads="5" max-threads="25" keepalive-time="5000" />
				</managed-executor-services>
				<managed-scheduled-executor-services>
					<managed-scheduled-executor-service
						name="default" jndi-name="java:jboss/ee/concurrency/scheduler/default"
						context-service="default" hung-task-threshold="60000"
						core-threads="2" keepalive-time="3000" />
				</managed-scheduled-executor-services>
			</concurrent>
			<default-bindings context-service="java:jboss/ee/concurrency/context/default"
				datasource="java:jboss/datasources/ExampleDS"
				jms-connection-factory="java:jboss/DefaultJMSConnectionFactory"
				managed-executor-service="java:jboss/ee/concurrency/executor/default"
				managed-scheduled-executor-service="java:jboss/ee/concurrency/scheduler/default"
				managed-thread-factory="java:jboss/ee/concurrency/factory/default" />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:ejb3:2.0">
			<session-bean>
				<stateful default-access-timeout="5000" cache-ref="simple"
					passivation-disabled-cache-ref="simple" />
				<singleton default-access-timeout="5000" />
			</session-bean>
			<pools>
				<bean-instance-pools>
					<strict-max-pool name="slsb-strict-max-pool"
						max-pool-size="20" instance-acquisition-timeout="5"
						instance-acquisition-timeout-unit="MINUTES" />
					<strict-max-pool name="mdb-strict-max-pool"
						max-pool-size="20" instance-acquisition-timeout="5"
						instance-acquisition-timeout-unit="MINUTES" />
				</bean-instance-pools>
			</pools>
			<caches>
				<cache name="simple" />
				<cache name="distributable" passivation-store-ref="infinispan"
					aliases="passivating clustered" />
			</caches>
			<passivation-stores>
				<passivation-store name="infinispan"
					cache-container="ejb" max-size="10000" />
			</passivation-stores>
			<async thread-pool-name="default" />
			<timer-service thread-pool-name="default"
				default-data-store="default-file-store">
				<data-stores>
					<file-data-store name="default-file-store" path="timer-service-data"
						relative-to="jboss.server.data.dir" />
				</data-stores>
			</timer-service>
			<remote connector-ref="http-remoting-connector"
				thread-pool-name="default" />
			<thread-pools>
				<thread-pool name="default">
					<max-threads count="10" />
					<keepalive-time time="100" unit="milliseconds" />
				</thread-pool>
			</thread-pools>
			<default-security-domain value="other" />
			<default-missing-method-permissions-deny-access
				value="true" />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:io:1.1">
			<worker name="default" />
			<buffer-pool name="default" />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:infinispan:2.0">
			<cache-container name="web" default-cache="passivation"
				module="org.wildfly.clustering.web.infinispan">
				<local-cache name="passivation" batching="true">
					<file-store passivation="true" purge="false" />
				</local-cache>
				<local-cache name="persistent" batching="true">
					<file-store passivation="false" purge="false" />
				</local-cache>
			</cache-container>
			<cache-container name="ejb" default-cache="passivation"
				module="org.wildfly.clustering.ejb.infinispan" aliases="sfsb">
				<local-cache name="passivation" batching="true">
					<file-store passivation="true" purge="false" />
				</local-cache>
				<local-cache name="persistent" batching="true">
					<file-store passivation="false" purge="false" />
				</local-cache>
			</cache-container>
			<cache-container name="hibernate" default-cache="local-query"
				module="org.hibernate">
				<local-cache name="entity">
					<transaction mode="NON_XA" />
					<eviction strategy="LRU" max-entries="10000" />
					<expiration max-idle="100000" />
				</local-cache>
				<local-cache name="local-query">
					<transaction mode="NONE" />
					<eviction strategy="LRU" max-entries="10000" />
					<expiration max-idle="100000" />
				</local-cache>
				<local-cache name="timestamps">
					<transaction mode="NONE" />
					<eviction strategy="NONE" />
				</local-cache>
			</cache-container>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:jaxrs:1.0" />
		<subsystem xmlns="urn:jboss:domain:jca:2.0">
			<archive-validation enabled="true" fail-on-error="true"
				fail-on-warn="false" />
			<bean-validation enabled="true" />
			<default-workmanager>
				<short-running-threads>
					<core-threads count="50" />
					<queue-length count="50" />
					<max-threads count="50" />
					<keepalive-time time="10" unit="seconds" />
				</short-running-threads>
				<long-running-threads>
					<core-threads count="50" />
					<queue-length count="50" />
					<max-threads count="50" />
					<keepalive-time time="10" unit="seconds" />
				</long-running-threads>
			</default-workmanager>
			<cached-connection-manager />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:jdr:1.0" />
		<subsystem xmlns="urn:jboss:domain:jmx:1.3">
			<expose-resolved-model />
			<expose-expression-model />
			<remoting-connector />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:jpa:1.1">
			<jpa default-datasource=""
				default-extended-persistence-inheritance="DEEP" />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:jsf:1.0" />
		<subsystem xmlns="urn:jboss:domain:mail:2.0">
			<mail-session name="default" jndi-name="java:jboss/mail/Default">
				<smtp-server outbound-socket-binding-ref="mail-smtp" />
			</mail-session>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:naming:2.0">
			<bindings>
				<simple name="java:global/redirect_on_success" value="/IRCT-UI/token.html" />
				<simple name="java:global/domain" value="${env.AUTH0_DOMAIN}"/>
				<simple name="java:global/userField" value="${env.IRCT_USER_FIELD:email}"/>
				<simple name="java:global/resultDataFolder" value="${env.RESULT_DATA_FOLDER:/scratch/irct}" />
				<simple name="java:global/client_secret" value="${env.CLIENT_SECRET:dummysecret}"/>
	            <simple name="java:global/client_id" value="${env.CLIENT_ID:dummyid}"/>
	            <simple name="java:global/KeyTimeOutInMinutes" value="${env.IRCT_KEY_TIMEOUT_IN_MINUTES:720}"/>

				<!-- If any of these three are missing, the system will default to sessionFilter.
				      token_introspection_url and token_introspection_token are only needed if verify_user_method is set to 'tokenIntrospection' -->
				<simple name="java:global/verify_user_method" value="${env.VERIFY_USER_METHOD:sessionFilter}"/>
				<simple name="java:global/token_introspection_url" value="${env.TOKEN_INTROSPECTION_URL}" />
				<simple name="java:global/token_introspection_token" value="${env.TOKEN_INTROSPECTION_TOKEN}"/>

				<!-- currently only supports absolute file path location -->
				<simple name="java:global/whitelist_enabled" value="${env.WHITELIST_ENABLED:false}" type="boolean" />
				<simple name="java:global/whitelist_config_file" value="${env.WHITELIST_CONFIG_FILE}" />

				<!-- Cross-Origin Resource Sharing configuration -->
				<simple name="java:global/cors_enabled" value="${env.CORS_ENABLED:false}" type="boolean" />
				<simple name="java:global/cors_allow_origin" value="${env.CORS_ALLOW_ORIGIN}" />
			</bindings>
			<remote-naming />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:pojo:1.0" />
		<subsystem xmlns="urn:jboss:domain:remoting:2.0">
			<endpoint worker="default" />
			<http-connector name="http-remoting-connector"
				connector-ref="default" security-realm="ApplicationRealm" />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:resource-adapters:2.0" />
		<subsystem xmlns="urn:jboss:domain:sar:1.0" />
		<subsystem xmlns="urn:jboss:domain:security:1.2">
			<security-domains>
				<security-domain name="other" cache-type="default">
					<authentication>
						<login-module code="Remoting" flag="optional">
							<module-option name="password-stacking" value="useFirstPass" />
						</login-module>
						<login-module code="RealmDirect" flag="required">
							<module-option name="password-stacking" value="useFirstPass" />
						</login-module>
					</authentication>
				</security-domain>
				<security-domain name="jboss-web-policy" cache-type="default">
					<authorization>
						<policy-module code="Delegating" flag="required" />
					</authorization>
				</security-domain>
				<security-domain name="jboss-ejb-policy" cache-type="default">
					<authorization>
						<policy-module code="Delegating" flag="required" />
					</authorization>
				</security-domain>
			</security-domains>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:transactions:2.0">
			<core-environment>
				<process-id>
					<uuid />
				</process-id>
			</core-environment>
			<recovery-environment socket-binding="txn-recovery-environment"
				status-socket-binding="txn-status-manager" />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:undertow:1.2">
			<buffer-cache name="default" />
			<server name="default-server">
				<http-listener name="default" socket-binding="http" />
				<host name="default-host" alias="localhost">
					<location name="/" handler="welcome-content" />
					<filter-ref name="server-header" />
					<filter-ref name="x-powered-by-header" />
				</host>
			</server>
			<servlet-container name="default">
				<jsp-config />
				<websockets />
			</servlet-container>
			<handlers>
				<file name="welcome-content" path="${jboss.home.dir}/welcome-content" />
			</handlers>
			<filters>
				<response-header name="server-header" header-name="Server"
					header-value="WildFly/8" />
				<response-header name="x-powered-by-header"
					header-name="X-Powered-By" header-value="Undertow/1" />
			</filters>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:webservices:1.2">
			<wsdl-host>${jboss.bind.address:127.0.0.1}</wsdl-host>
			<endpoint-config name="Standard-Endpoint-Config" />
			<endpoint-config name="Recording-Endpoint-Config">
				<pre-handler-chain name="recording-handlers"
					protocol-bindings="##SOAP11_HTTP ##SOAP11_HTTP_MTOM ##SOAP12_HTTP ##SOAP12_HTTP_MTOM">
					<handler name="RecordingHandler"
						class="org.jboss.ws.common.invocation.RecordingServerHandler" />
				</pre-handler-chain>
			</endpoint-config>
			<client-config name="Standard-Client-Config" />
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:weld:2.0" />
	</profile>
	<interfaces>
		<interface name="management">
			<inet-address value="${jboss.bind.address.management:127.0.0.1}" />
		</interface>
		<interface name="public">
			<inet-address value="${jboss.bind.address:0.0.0.0}" />
		</interface>
		<interface name="unsecure">
			<inet-address value="${jboss.bind.address.unsecure:0.0.0.0}" />
		</interface>
	</interfaces>
	<socket-binding-group name="standard-sockets"
		default-interface="public" port-offset="${jboss.socket.binding.port-offset:0}">
		<socket-binding name="management-http" interface="management"
			port="4000" />
		<socket-binding name="management-https" interface="management"
			port="${jboss.management.https.port:9993}" />
		<socket-binding name="ajp" port="${jboss.ajp.port:8009}" />
		<socket-binding name="http" port="${jboss.http.port:8080}" />
		<socket-binding name="https" port="${jboss.https.port:8443}" />
		<socket-binding name="txn-recovery-environment" port="4712" />
		<socket-binding name="txn-status-manager" port="4713" />
		<outbound-socket-binding name="mail-smtp">
			<remote-destination host="localhost" port="25" />
		</outbound-socket-binding>
	</socket-binding-group>
</server>
